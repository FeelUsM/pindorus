<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<script src="jquery-2.2.0.js"></script>
	<script src="jjv.js"></script>
	<script src="meta_schema.js"></script>
	<style>
		span{
			margin-right:10px;
		}
	</style>
</head>

<body>
<div id="types"></div>

<script>
//alert('lf')
var DB = load();
for(var i in DB.noun_types){
	var curtype = DB.noun_types[i];
	DB.noun_types[i].$words = $('<br/><div id="'+i+'">\
	№<span>'+i+'</span>\
	('+curtype.ип+','+curtype.рп+','+curtype.дп+','+curtype.вп+','+curtype.тп+','+curtype.пп+') \
	число:<span>'+curtype.число+'</span>\
	род:<span>'+curtype.род+'</span>\
	одушевленность:<span>'+(curtype.одушевленность )+'</span>\
	склонение:<span>'+curtype.склонение+'</span>\
<br/></div>');
	DB.noun_types[i].$words.appendTo($('#types'))
}
for(var w in DB.nouns){
	var curword = DB.nouns[w];
	curword.type.$words.append(w+', ');
}

function select(){
	var id = $('#scl_id').val();
	$('#scl').text(DB.noun_types[id].склонение);
	$('#num').text(DB.noun_types[id].число);
	$('#gender').text(DB.noun_types[id].род);
	$('#hum').text(DB.noun_types[id].одушевленность);
	$('#words').text(DB.noun_types[id].words);
}

function load(){
	var DB =  JSON.parse(localStorage.getItem('DB'));
	schemas_init();
	var errs = schemas.validate('noun', DB, {useCoerce:'parse'} );
	if(errs) {
		console.log('DB не соответствует noun-схеме');
		console.dir(errs);
		alert('DB не соответствует noun-схеме');
	}
	return DB;
}

function schemas_init(){
var noun_schema = {
	$schema: 'my_meta_schema',
	id: 'noun',
	description: 'dictionary',
	type: 'object',
	required: ['noun_types','nouns'],
	properties: {
		noun_types: {
			id: 'noun_types',
			uniquePatternProperties: {
				'^[0-9]+$': {
					id: 'noun_type',
					required: [ "ип","рп","дп","вп","тп","пп","число","род","склонение" ],
					properties: {
						"ип": { type: 'string' },
						"рп": { type: 'string' },
						"дп": { type: 'string' },
						"вп": { type: 'string' },
						"тп": { type: 'string' },
						"пп": { type: 'string' },
						"число": { enum: [ 'ед','мн' ] },
						"род": { enum: [ 'м','ж','с','о' ] },
						"склонение": { type: 'string', minLength: 1 },
						"одушевленность": { type: [ 'boolean' ] },
					},
					additionalProperties: false,
				},
			},
			additionalProperties: false,
		},
		nouns: {
			patternProperties: {
				'^[а-яА-ЯёЁйЙ]+$': {
					id:'noun',
					required: [ 'type', 'wiki' ],
					properties: {
						type: { isPropertyOf: '/noun_types', parseCoerce: 'propLink', stringifyCoerce: 'propLink' },
						wiki: { type: ['boolean'] },
						other_num: { isPropertyOf: '/nouns' },
					},
					additionalProperties:true,
				},
			},
			additionalProperties:false,
		},
	},
	additionalProperties:true,
}
	schemas.addSchema('noun',noun_schema);
	var res = schemas.validate('my_meta_schema',noun_schema)
	if(res){
		console.log('noun схема не валидна');
		console.dir(res);
		alert('noun схема не валидна');
	}
}


</script>
</body>

</html>
